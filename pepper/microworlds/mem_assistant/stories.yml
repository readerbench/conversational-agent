version: "3.0"

stories:
  - story: retrieve location
    steps:
      - intent: mem_assistant.get_location
      - action: action_get_location

  - story: store location
    steps:
      - intent: mem_assistant.store_request
      - action: utter_listening
      - intent: mem_assistant.store_location
      - action: action_store_location
      - action: utter_stored

  - story: retrieve attribute
    steps:
      - intent: mem_assistant.get_attr
      - action: action_get_attr

  - story: store attribute
    steps:
      - intent: mem_assistant.store_request
      - action: utter_listening
      - intent: mem_assistant.store_attr
      - action: action_store_attr
      - action: utter_stored

  - story: retrieve timestamp
    steps:
      - intent: mem_assistant.get_timestamp
      - action: action_get_time

  - story: store timestamp
    steps:
      - intent: mem_assistant.store_timestamp
      - action: action_store_time
      - action: utter_stored

rules:
  - rule: store following attribute start
    steps:
      - intent: mem_assistant.store_following_attr  # intent that triggers form activation
      - action: action_keep_raw_attr_entity
      - action: raw_data_store_form  # run the form
      - active_loop: raw_data_store_form  # this form is active

  - rule: store following attribute submit
    condition:
      - active_loop: raw_data_store_form  # this form must be active
    steps:
      - action: raw_data_store_form
      - active_loop: null  # the form is no longer active because it has been filled
      - action: action_raw_data_store  # action to take after the form is complete
      - action: utter_stored
